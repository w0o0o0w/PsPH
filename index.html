<html>
<head>
<title>PS-Phive! (FOR PS4 FW v9.00) v1.0 By Leeful</title>
<style>
html{margin:0px;}
body{background-color:#1849A5;background:url("files/img/BG.jpg");background-size:cover;background-repeat:no-repeat;color:#DDE5EA;font-family:sans-serif;font-size:22px;overflow:hidden;cursor:none;margin:0px;}
.cacheUPDbg {transition:opacity 600ms;position:fixed;left:0;right:0;top:0;bottom:0;max-width:100%;max-height:100%;margin:auto;	width:100%;height:100%;opacity:1;display:none;z-index:900;}
.cacheUPDtext{position:absolute;left:0;top:318px;width:100%;margin:auto;height:400px;line-height:30px;align-items:left;font-family:sans-serif;font-size:28px;text-align:center;color:white;z-index:901;text-shadow: -2px 2px #274478;}
#CacheProgress {
    position: fixed;
    left: 230px;
    top: 0;
    bottom: 30px;
    max-width: 100%;
    max-height: 100%;
    margin: auto;
    width: 1076px; /* 538 + 538 */
    height: 8px;
    background-color: transparent;
    border: 3px solid #8C9CB6;
    border-radius: 3px;
}
.CacheBar{width:0%;height:100%;background-color:white;}
.Loader{background-color:transparent;transition:opacity 1000ms;opacity:0;}
#console {
    background-color: rgba(0, 0, 0, 0.75); 
    color: #ebebeb; 
    font-family: monospace;
    font-size: 16px;
    padding: 10px;
    margin: 10px;
    height: 250px; 
    overflow-y: scroll; 
    border: 1px solid #ebebeb;
    border-radius: 5px;
    white-space: pre-wrap;
    position: fixed; 
    bottom: 0;
    left: 0;
    width: -webkit-fill-available;
    z-index: 999; 
}
</style>
<script src="files/bundle.js"></script>
<script>
if (localStorage.length == 0) {
 if (localStorage.GHver == null){localStorage.GHver = "v2.4b18.7";}
 if (localStorage.autoGH == null){localStorage.autoGH = "OFF";}
 if (localStorage.passcount == null){localStorage.passcount=0;}
 if (localStorage.failcount == null){localStorage.failcount=0;}
}

function checkGHBLS(){
 var req = new XMLHttpRequest();
 req.open("GET", "http://127.0.0.1:9090/status");
 req.send();
 req.onload = function(){
  Loader.innerHTML='<object id="mymenu" type="text/html" data="files/menu.html" style="width:100%; height:100%; background-color:transparent;"></object>';
  setTimeout(function(){Loader.style.opacity="1";},500);
 }
 req.onerror = function(){setTimeout(runJB,500);}
}

async function runJB(){
    ScrOverlay.style.display="block";
    CacheProgress.style.display="none";
    cacheUPDtxt.innerHTML="Running Webkit Exploit, Please Wait ...";
    
    outputConsole.textContent = ""; // Clear console log
    
    try {
        const result = await doJBwithPSFreeLapseExploit();
        
        if (result === true) {
            JBpass();
        } else {
            window.log("Exploit returned false or undefined - not successful", "orange");
        }
    } catch (error) {
        window.log("An error occured during exploit: " + error, "red");
        cacheUPDtxt.innerHTML = "Exploit failed! See console for details.";
        localStorage.failcount = ++localStorage.failcount;
    }
}

function go(){
 if (window.applicationCache.status=='0'){
  ScrOverlay.style.display="block";Loader.innerHTML='<object type="text/html" data="files/installCacheMain.html" style="width:265px; height:56px;"></object>';
 }
 else {
 checkGHBLS();  
 }
}
</script>
</head>
<body onload="go()">
<div id=ScrOverlay class=cacheUPDbg><pre id=cacheUPDtxt class=cacheUPDtext></pre><div id=CacheProgress><div id=CacheBar class=CacheBar></div></div></div>
<div id=Loader class=Loader></div>
<pre id="console"></pre>

<script>
const outputConsole = document.getElementById("console");
//window.log = (msg, color="#cccccc") => { outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`; };
window.log = (msg, color="#cccccc") => { outputConsole.innerHTML += `<span style="color:${color}">${msg}</span><br>`; outputConsole.scrollTop = outputConsole.scrollHeight;};


// Event definitions
addEventListener('unhandledrejection', event => {
    const reason = event.reason;
    alert(
    'Unhandled rejection\n'
    + `${reason}\n`
    + `${reason.sourceURL}:${reason.line}:${reason.column}\n`
    + `${reason.stack}`
    );
});

addEventListener('error', event => {
    const reason = event.error;
    alert(
    'Unhandled error\n'
    + `${reason}\n`
    + `${reason.sourceURL}:${reason.line}:${reason.column}\n`
    + `${reason.stack}`
    );
    return true; // Used for not to show error message on console
});

function JBpass(){
 ScrOverlay.style.opacity="0";
 document.getElementById('console').style.display = 'none';
 setTimeout(function(){ScrOverlay.style.display="none";},600);
 Loader.innerHTML='<object id="mymenu" type="text/html" data="files/menu.html" style="width:100%; height:100%; background-color:transparent;"></object>';
 setTimeout(function(){
  localStorage.passcount= ++localStorage.passcount;mymenu.contentWindow.passCounter.innerHTML=localStorage.passcount;
  mymenu.contentWindow.failCounter.innerHTML=localStorage.failcount;
 },1100);
  setTimeout(function(){Loader.style.opacity="1";},500);
 if(localStorage.autoGH=="ON")
  setTimeout(function(){mymenu.contentWindow.LoadPL();},1500);
}

function JBalreadyDone(){
 ScrOverlay.style.opacity="0";
 setTimeout(function(){ScrOverlay.style.display="none";},600);
 Loader.innerHTML='<object id="mymenu" type="text/html" data="files/menu.html" style="width:100%; height:100%; background-color:transparent;"></object>';
 setTimeout(function(){Loader.style.opacity="1";},500);
}
</script>
</body>
</html>